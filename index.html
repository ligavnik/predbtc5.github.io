<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTC 5M Oracle â€¢ Polymarket</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@400;500;600;700;900&family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{
            --bg:#06060a;--s1:#0c0c12;--s2:#121218;--s3:#1a1a22;--s4:#24242e;
            --border:rgba(255,255,255,0.05);--bh:rgba(255,255,255,0.10);
            --t1:#eeeef0;--t2:#8a8a9a;--t3:#4a4a58;
            --bull:#00e676;--bull-d:rgba(0,230,118,0.12);
            --bear:#ff1744;--bear-d:rgba(255,23,68,0.12);
            --amber:#ffab00;--amber-d:rgba(255,171,0,0.10);
            --poly:#4c6ef5;--poly-d:rgba(76,110,245,0.10);
            --ff:'Outfit',sans-serif;--fm:'Azeret Mono',monospace;
        }
        body{background:var(--bg);color:var(--t1);font-family:var(--ff);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
        body::before{content:'';position:fixed;inset:0;background:linear-gradient(rgba(255,171,0,0.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,171,0,0.015) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0}
        body::after{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 30% 20%,rgba(255,171,0,0.04),transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(0,230,118,0.03),transparent 40%);pointer-events:none;z-index:0}
        .app{position:relative;z-index:1;max-width:1440px;margin:0 auto;padding:0 10px}
        .card{background:var(--s1);border:1px solid var(--border);border-radius:14px;transition:border-color 0.3s}.card:hover{border-color:var(--bh)}
        ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--s4);border-radius:4px}
        .hdr{position:sticky;top:0;z-index:50;background:rgba(6,6,10,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 10px}
        .hdr-in{max-width:1440px;margin:0 auto;height:48px;display:flex;align-items:center;justify-content:space-between}
        .m{font-family:var(--fm)}
        .dot{width:6px;height:6px;border-radius:50%;display:inline-block}
        .dot-on{background:var(--bull);box-shadow:0 0 6px var(--bull)}.dot-w{background:var(--amber)}.dot-off{background:var(--t3)}
        .badge{display:inline-flex;align-items:center;gap:4px;padding:2px 7px;border-radius:5px;font-size:9px;font-weight:700;font-family:var(--fm);letter-spacing:0.03em}
        .chart-w{position:relative;height:340px;width:100%}
        @media(max-width:768px){.chart-w{height:220px}}
        @keyframes fu{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
        @keyframes fg{0%{color:var(--bull)}100%{color:var(--t1)}}
        @keyframes fr{0%{color:var(--bear)}100%{color:var(--t1)}}
        @keyframes si{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}
        @keyframes fo{to{opacity:0;transform:translateX(16px)}}
        .tz{position:fixed;top:56px;right:10px;z-index:200;display:flex;flex-direction:column;gap:5px;pointer-events:none}
        .toast{pointer-events:auto;padding:8px 14px;border-radius:8px;font-size:11px;font-weight:600;display:flex;align-items:center;gap:6px;animation:si 0.3s ease-out,fo 0.3s ease 3.5s forwards;box-shadow:0 6px 20px rgba(0,0,0,0.5);font-family:var(--fm)}
        .tw{background:#0a2e1a;border:1px solid #14532d;color:#86efac}
        .tl{background:#2e0a0a;border:1px solid #450a0a;color:#fca5a5}
        .ti{background:#0a0a2e;border:1px solid #1e1b4b;color:#c7d2fe}
        .tk{background:#2e1f0a;border:1px solid #422006;color:#fde68a}
        .ind{display:flex;align-items:center;justify-content:space-between;padding:5px 8px;border-radius:6px;background:var(--s2);border:1px solid var(--border);font-size:10px;font-family:var(--fm)}
        .tabs{display:flex;gap:2px;background:var(--s2);border-radius:7px;padding:2px}
        .tab{padding:4px 10px;border-radius:5px;font-size:10px;font-weight:700;font-family:var(--fm);cursor:pointer;transition:all 0.2s;color:var(--t3);background:transparent;border:none}
        .tab.a{background:var(--s4);color:var(--t1)}.tab:not(.a):hover{color:var(--t2)}
        .pb{border-color:rgba(0,230,118,0.2)!important;box-shadow:0 0 40px -10px rgba(0,230,118,0.15)}
        .pr{border-color:rgba(255,23,68,0.2)!important;box-shadow:0 0 40px -10px rgba(255,23,68,0.15)}
        .ob{display:flex;height:5px;border-radius:3px;overflow:hidden;background:var(--s3)}
        .ob-u{background:var(--bull);transition:width 0.5s}.ob-d{background:var(--bear);transition:width 0.5s}
        .bb{position:relative;overflow:hidden;border-radius:11px;padding:12px;font-weight:800;cursor:pointer;border:1px solid;transition:all 0.15s;font-family:var(--ff);font-size:14px;text-align:center}
        .bb:active{transform:scale(0.96)}
        .bb-u{background:linear-gradient(135deg,rgba(0,230,118,0.10),rgba(0,230,118,0.03));border-color:rgba(0,230,118,0.15);color:var(--bull)}
        .bb-u:hover{border-color:rgba(0,230,118,0.35)}
        .bb-d{background:linear-gradient(135deg,rgba(255,23,68,0.10),rgba(255,23,68,0.03));border-color:rgba(255,23,68,0.15);color:var(--bear)}
        .bb-d:hover{border-color:rgba(255,23,68,0.35)}
        .ht{width:100%;text-align:left;font-size:10px;border-collapse:collapse}
        .ht th{padding:7px 10px;font-size:9px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:0.08em;font-family:var(--fm);background:var(--s2);position:sticky;top:0;z-index:2}
        .ht td{padding:7px 10px;border-bottom:1px solid var(--border);font-family:var(--fm);color:var(--t2)}
        .ht tr:hover td{background:rgba(255,255,255,0.015)}
        .st{font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:0.1em;font-family:var(--fm);margin-bottom:8px;display:flex;align-items:center;gap:5px}
        .pl{display:inline-flex;align-items:center;gap:4px;padding:4px 9px;border-radius:6px;background:var(--poly-d);border:1px solid rgba(76,110,245,0.15);color:#8da4ff;font-size:10px;font-weight:700;font-family:var(--fm);text-decoration:none;transition:all 0.2s}
        .pl:hover{background:rgba(76,110,245,0.15);color:#a8bdff}
        .rw{position:relative;display:flex;align-items:center;justify-content:center}
        .rw svg{transform:rotate(-90deg)}
        @media(min-width:1024px){.gt{grid-template-columns:1fr 190px 1fr}.gb{grid-template-columns:1fr 1fr}}
        .g{display:grid;gap:10px}
        .hm{display:none}@media(min-width:768px){.hm{display:flex}}
    </style>
</head>
<body>
<div id="tz" class="tz"></div>
<header class="hdr"><div class="hdr-in">
    <div style="display:flex;align-items:center;gap:8px">
        <div style="width:30px;height:30px;background:linear-gradient(135deg,#ffab00,#ff6d00);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 3px 10px rgba(255,171,0,0.25)"><i class="fa-brands fa-bitcoin" style="color:#fff"></i></div>
        <div><div style="font-weight:800;font-size:14px;line-height:1;letter-spacing:-0.02em">BTC<span style="color:var(--amber)">5M</span></div>
        <div class="m" style="font-size:8px;color:var(--t3);display:flex;align-items:center;gap:3px"><span class="dot dot-off" id="hd"></span><span id="hs">CONNECTING</span></div></div>
    </div>
    <div style="display:flex;align-items:center;gap:6px">
        <div class="hm badge" style="background:var(--s2);color:var(--t3);border:1px solid var(--border)" id="sb">W:<span id="sw">0</span> | L:<span id="sl">0</span> | <span id="sp">--</span>%</div>
        <button onclick="tgS()" id="sbt" style="width:30px;height:30px;border-radius:7px;background:var(--s2);border:1px solid var(--border);color:var(--t3);font-size:11px;cursor:pointer" title="Sound"><i class="fa-solid fa-volume-high"></i></button>
        <a id="ptl" href="https://polymarket.com/crypto/5M" target="_blank" style="display:inline-flex;align-items:center;gap:4px;padding:5px 12px;border-radius:8px;background:var(--poly);color:#fff;font-size:10px;font-weight:800;text-decoration:none;box-shadow:0 3px 10px rgba(76,110,245,0.3);transition:all 0.2s">Trade <i class="fa-solid fa-arrow-up-right-from-square" style="font-size:8px;opacity:0.6"></i></a>
    </div>
</div></header>

<div class="app" style="padding-top:10px;padding-bottom:32px">

<!-- ROW 1 -->
<div class="g gt" style="margin-bottom:10px">
<!-- PRICE -->
<div class="card" style="padding:14px 16px;position:relative;overflow:hidden">
    <div style="position:absolute;top:-16px;right:-8px;font-size:100px;opacity:0.02"><i class="fa-brands fa-bitcoin"></i></div>
    <div style="position:relative;z-index:1">
        <div style="display:flex;align-items:center;gap:5px;margin-bottom:6px"><span class="m" style="font-size:9px;font-weight:700;color:var(--t3)">BTC / USD</span><span class="badge" style="background:var(--s2);color:var(--t3);border:1px solid var(--border);font-size:8px" id="srcb">BINANCE</span></div>
        <div id="lp" class="m" style="font-size:34px;font-weight:900;letter-spacing:-0.04em;line-height:1">$--,---.--</div>
        <div style="display:flex;align-items:center;gap:6px;margin-top:6px">
            <span id="tp" class="badge" style="background:var(--s3);color:var(--t3)">Waiting...</span>
            <span id="sc" class="m" style="font-size:9px;color:var(--t3)">Session: --</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)">
            <div><div class="m" style="font-size:8px;color:var(--t3);font-weight:700">HIGH</div><div id="sh" class="m" style="font-size:11px;color:var(--bull)">--</div></div>
            <div><div class="m" style="font-size:8px;color:var(--t3);font-weight:700">LOW</div><div id="slo" class="m" style="font-size:11px;color:var(--bear)">--</div></div>
        </div>
    </div>
</div>

<!-- COUNTDOWN -->
<div class="card" style="padding:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center">
    <div class="m" style="font-size:8px;font-weight:700;color:var(--t3);letter-spacing:0.1em;margin-bottom:6px">WINDOW CLOSES</div>
    <div class="rw" style="margin-bottom:4px">
        <svg width="90" height="90" viewBox="0 0 90 90"><circle class="ring-track" cx="45" cy="45" r="38" fill="none" stroke="var(--s3)" stroke-width="4"/><circle id="rf" cx="45" cy="45" r="38" fill="none" stroke="var(--amber)" stroke-width="4" stroke-dasharray="238.76" stroke-dashoffset="0" stroke-linecap="round" style="transition:stroke-dashoffset 1s linear"/></svg>
        <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center"><div id="cd" class="m" style="font-size:24px;font-weight:900;color:var(--amber);letter-spacing:-0.02em">--:--</div></div>
    </div>
    <div id="wr" class="m" style="font-size:9px;color:var(--t3)">--:-- â†’ --:--</div>
    <div id="wl" class="badge" style="background:var(--s3);color:var(--t3);margin-top:4px">WAITING</div>
    <!-- Polymarket Odds -->
    <div style="width:100%;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
        <div style="display:flex;justify-content:space-between;margin-bottom:3px">
            <span class="m" style="font-size:9px;color:var(--bull);font-weight:700">UP <span id="ou">50</span>Â¢</span>
            <span class="m" style="font-size:9px;color:var(--bear);font-weight:700"><span id="od">50</span>Â¢ DN</span>
        </div>
        <div class="ob"><div class="ob-u" id="obu" style="width:50%"></div><div class="ob-d" id="obd" style="width:50%"></div></div>
        <div class="m" style="font-size:8px;color:var(--t3);text-align:center;margin-top:2px">Polymarket Implied</div>
    </div>
</div>

<!-- AI PREDICTION -->
<div id="pc" class="card" style="padding:14px 16px;display:flex;flex-direction:column;justify-content:space-between;transition:all 0.5s">
    <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <div class="st" style="margin-bottom:0"><i class="fa-solid fa-brain" style="color:var(--amber)"></i> AI ORACLE</div>
            <span id="cs" class="badge" style="background:var(--s3);color:var(--t3)">WAITING</span>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
            <div id="pi" style="width:48px;height:48px;border-radius:12px;background:var(--s3);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--t3);flex-shrink:0;transition:all 0.4s"><i class="fa-solid fa-hourglass-half"></i></div>
            <div><div id="pt" style="font-size:26px;font-weight:900;letter-spacing:-0.03em;color:var(--t3);line-height:1">WAIT</div><div id="pf" class="m" style="font-size:10px;color:var(--t3);margin-top:2px">Confidence: --%</div></div>
        </div>
    </div>
    <div style="margin-top:10px;display:flex;flex-direction:column;gap:3px">
        <div class="ind"><span style="color:var(--t3)">Strike</span><span id="is" style="color:var(--t1)">â€”</span></div>
        <div class="ind"><span style="color:var(--t3)">RSI(14)</span><span id="ir" style="color:var(--t1)">â€”</span></div>
        <div class="ind"><span style="color:var(--t3)">EMA 9/21</span><span id="ie" style="color:var(--t1)">â€”</span></div>
        <div class="ind"><span style="color:var(--t3)">MACD</span><span id="im" style="color:var(--t1)">â€”</span></div>
        <div class="ind"><span style="color:var(--t3)">Momentum</span><span id="imo" style="color:var(--t1)">â€”</span></div>
        <div class="ind"><span style="color:var(--t3)">Volatility</span><span id="iv" style="color:var(--t1)">â€”</span></div>
    </div>
</div>
</div>

<!-- ROW 2: CHART -->
<div class="card" style="padding:3px;margin-bottom:10px">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px 4px">
        <div style="display:flex;align-items:center;gap:6px">
            <span class="dot dot-on" style="width:5px;height:5px"></span>
            <span class="m" style="font-size:9px;font-weight:700;color:var(--t2)">LIVE</span>
            <span class="m" style="font-size:9px;color:var(--t3)">BTC/USD â€¢ Chainlink Settlement</span>
        </div>
        <div class="tabs" id="ct">
            <button class="tab a" data-tf="1" onclick="sTf(1)">1s</button>
            <button class="tab" data-tf="3" onclick="sTf(3)">3s</button>
            <button class="tab" data-tf="5" onclick="sTf(5)">5s</button>
            <button class="tab" data-tf="15" onclick="sTf(15)">15s</button>
        </div>
    </div>
    <div class="chart-w"><canvas id="mc"></canvas></div>
</div>

<!-- ROW 3 -->
<div class="g gb">
<!-- GLOBAL HISTORY -->
<div class="card" style="overflow:hidden;display:flex;flex-direction:column;height:370px">
    <div style="padding:10px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0">
        <div class="st" style="margin-bottom:0"><i class="fa-solid fa-globe" style="color:var(--poly)"></i> GLOBAL HISTORY</div>
        <div style="display:flex;align-items:center;gap:5px">
            <span id="ss" class="badge" style="background:var(--poly-d);color:var(--poly);border:1px solid rgba(76,110,245,0.15)">SYNCING</span>
            <a id="pml" href="https://polymarket.com/crypto/5M" target="_blank" class="pl" style="font-size:9px;padding:2px 7px">Market <i class="fa-solid fa-arrow-up-right-from-square" style="font-size:7px"></i></a>
        </div>
    </div>
    <div style="flex:1;overflow-y:auto"><table class="ht"><thead><tr><th>Time</th><th>Call</th><th>Strike</th><th>Close</th><th style="text-align:right">Result</th></tr></thead><tbody id="hb"><tr><td colspan="5" style="text-align:center;padding:30px 10px;color:var(--t3);font-style:italic;font-size:10px">Connecting to global feed...</td></tr></tbody></table></div>
</div>

<!-- MANUAL -->
<div class="card" style="padding:14px;display:flex;flex-direction:column;height:370px">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;flex-shrink:0">
        <div class="st" style="margin-bottom:0"><i class="fa-solid fa-crosshairs" style="color:var(--amber)"></i> YOUR CALLS</div>
        <div style="display:flex;align-items:center;gap:5px">
            <span id="ms" class="m" style="font-size:9px;color:var(--t3)">0W / 0L</span>
            <button onclick="cMB()" style="background:var(--s3);border:1px solid var(--border);border-radius:5px;padding:2px 6px;color:var(--t3);font-size:9px;cursor:pointer"><i class="fa-solid fa-trash-can"></i></button>
        </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px;flex-shrink:0">
        <button onclick="pMB('UP')" class="bb bb-u"><i class="fa-solid fa-arrow-trend-up" style="margin-right:3px;font-size:12px"></i> LONG<div style="font-size:9px;font-weight:500;opacity:0.5;margin-top:1px">Predict Up</div></button>
        <button onclick="pMB('DOWN')" class="bb bb-d"><i class="fa-solid fa-arrow-trend-down" style="margin-right:3px;font-size:12px"></i> SHORT<div style="font-size:9px;font-weight:500;opacity:0.5;margin-top:1px">Predict Down</div></button>
    </div>
    <div style="flex:1;overflow-y:auto" id="ml"><div style="text-align:center;color:var(--t3);font-size:10px;margin-top:24px">Place a call to start tracking.</div></div>
</div>
</div>

<footer class="m" style="text-align:center;padding:16px 0 6px;font-size:8px;color:var(--t3)">
    <p>Chainlink Oracle Settlement â€¢ Binance Real-time Feed â€¢ Supabase Sync</p>
    <p style="opacity:0.4;margin-top:3px">Polymarket prediction tool â€” not financial advice.</p>
</footer>
</div>

<script>
// CONFIG
const SU='https://zbugvtypukklxpvrzxra.supabase.co';
const SK='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpidWd2dHlwdWtrbHhwdnJ6eHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MjMwNzgsImV4cCI6MjA4NTk5OTA3OH0.aHYE5M0NOsxqJakcKmKTi2MfaxZbPhmMsiz9Hi6zQMc';

// STATE
let sp=null,ws=null,ch=null,lp=0,pp=0,lt=0,sH=0,sL=Infinity,sO=0;
let c1s=[],tf=1,cP=null,snd=JSON.parse(localStorage.getItem('b5s')?? 'true');
let mB=JSON.parse(localStorage.getItem('b5b4')?? '[]');
let st=JSON.parse(localStorage.getItem('b5st2')?? '{"w":0,"l":0,"k":0,"t":""}');
let rc=0;const CL=600,TL=3000;

window.onload=()=>{iCh();iSp();cPr();sCd();rMB();uSt();uSB();rSt();fPO();setInterval(fPO,30000)};

// SUPABASE
function iSp(){
    if(SU.includes('YOUR_')||SK.includes('YOUR_'))return;
    try{sp=window.supabase.createClient(SU,SK);sSub();lHist();$s('ss','LIVE','var(--poly-d)','var(--poly)')}catch(e){$s('ss','ERR','var(--bear-d)','var(--bear)')}
}
async function sDB(d){if(!sp)return;try{await sp.from('btc_5m_calls').upsert([d],{onConflict:'id'})}catch(e){}}
function sSub(){if(!sp)return;sp.channel('b5m').on('postgres_changes',{event:'*',schema:'public',table:'btc_5m_calls'},p=>{if(p.eventType==='INSERT'||p.eventType==='UPDATE')aHR(p.new,true)}).subscribe()}
async function lHist(){if(!sp)return;try{const{data:d}=await sp.from('btc_5m_calls').select('*').order('window_time',{ascending:false}).limit(30);if(d?.length){document.getElementById('hb').innerHTML='';d.forEach(r=>aHR(r,false));let w=0,l=0;d.forEach(r=>{if(r.result==='WIN')w++;else if(r.result==='LOSS')l++});st.w=w;st.l=l;uSt()}}catch(e){}}

function aHR(r,a){
    const b=document.getElementById('hb'),ph=b.querySelector('td[colspan]');if(ph)ph.parentElement.remove();
    const ex=b.querySelector(`tr[data-id="${r.id}"]`);if(ex)ex.remove();
    const tr=document.createElement('tr');tr.setAttribute('data-id',r.id);
    if(a)tr.style.animation='fu 0.3s ease-out';
    const t=new Date(r.window_time).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    const dc=r.direction==='UP'?'var(--bull)':'var(--bear)',di=r.direction==='UP'?'fa-arrow-trend-up':'fa-arrow-trend-down';
    const ep=r.end_price?'$'+N(r.end_price):'â€”';
    let rb='<span class="badge" style="background:var(--s3);color:var(--t3)">PEND</span>';
    if(r.result==='WIN')rb='<span class="badge" style="background:var(--bull-d);color:var(--bull)">WIN</span>';
    else if(r.result==='LOSS')rb='<span class="badge" style="background:var(--bear-d);color:var(--bear)">LOSS</span>';
    tr.innerHTML=`<td>${t}</td><td style="color:${dc};font-weight:700"><i class="fa-solid ${di}" style="font-size:8px;margin-right:2px"></i>${r.direction} <span style="opacity:0.4;font-weight:400">${r.confidence||'--'}%</span></td><td>$${N(r.start_price)}</td><td>${ep}</td><td style="text-align:right">${rb}</td>`;
    b.insertBefore(tr,b.firstChild);while(b.children.length>30)b.removeChild(b.lastChild);
}

// POLYMARKET ODDS
async function fPO(){
    try{
        const n=Math.floor(Date.now()/1000),ws=n-(n%300);
        for(const s of[`btc-updown-5m-${ws}`,`btc-updown-5m-${ws+300}`,`btc-updown-5m-${ws-300}`]){
            try{
                const r=await fetch(`https://gamma-api.polymarket.com/events?slug=${s}`);
                if(!r.ok)continue;const ev=await r.json();
                if(ev?.length>0){
                    const m=ev[0].markets?.[0];if(m){
                        const p=JSON.parse(m.outcomePrices||'["0.5","0.5"]');
                        uOd(Math.round(parseFloat(p[0])*100),Math.round(parseFloat(p[1])*100));
                        const u=`https://polymarket.com/event/${s}`;
                        document.getElementById('ptl').href=u;document.getElementById('pml').href=u;
                    }break;
                }
            }catch(e){continue}
        }
    }catch(e){}
}
function uOd(u,d){document.getElementById('ou').textContent=u;document.getElementById('od').textContent=d;document.getElementById('obu').style.width=u+'%';document.getElementById('obd').style.width=d+'%'}

// PRICE FEED
function cPr(){
    uCn('c');
    try{
        ws=new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade');
        ws.onopen=()=>{rc=0;uCn('on');document.getElementById('srcb').textContent='BINANCE'};
        ws.onmessage=e=>{try{const d=JSON.parse(e.data);if(d.p)oP(parseFloat(d.p))}catch(e){}};
        ws.onclose=()=>{uCn('w');rc++;setTimeout(cPr,Math.min(2000*Math.pow(1.3,rc),20000))};
        ws.onerror=()=>{};
    }catch(e){uCn('off');setTimeout(cPr,5000)}
}
setInterval(()=>{if(Date.now()-lt>8000&&lt>0){try{ws.close()}catch(e){}}},5000);
function uCn(s){const d=document.getElementById('hd'),t=document.getElementById('hs');if(s==='on'){d.className='dot dot-on';t.textContent='LIVE'}else if(s==='w'){d.className='dot dot-w';t.textContent='RECONN'}else{d.className='dot dot-off';t.textContent='CONNECTING'}}

// PRICE HANDLER
function oP(p){
    const n=Date.now();
    // 1s candles
    const sec=Math.floor(n/1000)*1000,lc=c1s[c1s.length-1];
    if(lc&&lc.t===sec){lc.h=Math.max(lc.h,p);lc.l=Math.min(lc.l,p);lc.c=p;lc.n++}
    else{c1s.push({t:sec,o:p,h:p,l:p,c:p,n:1});if(c1s.length>CL)c1s.shift()}
    // Throttle UI
    if(n-lt<200){lp=p;return}lt=n;pp=lp;lp=p;
    if(!sO)sO=p;
    if(p>sH||!sH){sH=p;document.getElementById('sh').textContent='$'+N(p)}
    if(p<sL){sL=p;document.getElementById('slo').textContent='$'+N(p)}
    const el=document.getElementById('lp');el.textContent='$'+N(p);
    if(pp>0&&p!==pp){
        const df=p-pp,up=df>0;el.style.animation='none';void el.offsetWidth;
        el.style.animation=up?'fg 0.4s ease-out':'fr 0.4s ease-out';
        const tp=document.getElementById('tp');tp.textContent=(up?'+':'')+df.toFixed(2);
        tp.style.background=up?'var(--bull-d)':'var(--bear-d)';tp.style.color=up?'var(--bull)':'var(--bear)';
    }
    if(sO>0){const pc=((p-sO)/sO*100).toFixed(2),s=document.getElementById('sc');s.textContent=`Session: ${pc>=0?'+':''}${pc}%`;s.style.color=pc>=0?'var(--bull)':'var(--bear)'}
    uCht();rOr(p,n);
}

// CHART
function iCh(){
    const x=document.getElementById('mc').getContext('2d');
    const g=x.createLinearGradient(0,0,0,400);g.addColorStop(0,'rgba(255,171,0,0.10)');g.addColorStop(1,'rgba(255,171,0,0)');
    ch=new Chart(x,{type:'line',data:{labels:[],datasets:[{label:'BTC/USD',data:[],borderWidth:1.5,pointRadius:0,pointHoverRadius:3,pointHoverBackgroundColor:'#ffab00',fill:true,tension:0.15,borderColor:'#ffab00',backgroundColor:g,
        segment:{borderColor:c=>{if(!c.p0||!c.p1)return'#ffab00';return c.p1.parsed.y>=c.p0.parsed.y?'#00e676':'#ff1744'}}}]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},
        plugins:{legend:{display:false},tooltip:{backgroundColor:'#0c0c12',borderColor:'rgba(255,255,255,0.08)',borderWidth:1,titleColor:'#8a8a9a',bodyColor:'#eeeef0',titleFont:{family:'Azeret Mono',size:9},bodyFont:{family:'Azeret Mono',size:11,weight:'700'},displayColors:false,padding:{top:6,bottom:6,left:10,right:10},cornerRadius:6,
            callbacks:{title:i=>{const d=gCD(),idx=i[0]?.dataIndex;return(idx!==undefined&&d[idx])?new Date(d[idx].t).toLocaleTimeString():''},label:i=>'$'+N(i.parsed.y)}},
            annotation:{annotations:{sl:{type:'line',yMin:0,yMax:0,borderColor:'rgba(255,171,0,0.35)',borderWidth:1,borderDash:[4,4],display:false,label:{display:true,content:'STRIKE',position:'start',backgroundColor:'rgba(255,171,0,0.12)',color:'#ffab00',font:{family:'Azeret Mono',size:8,weight:'700'},padding:{top:2,bottom:2,left:5,right:5},borderRadius:3}}}}},
        scales:{x:{display:true,grid:{display:false},ticks:{maxTicksLimit:8,color:'#4a4a58',font:{family:'Azeret Mono',size:8},callback:function(v,i){const d=gCD();return d[i]?new Date(d[i].t).toLocaleTimeString([],{minute:'2-digit',second:'2-digit'}):''}}},
            y:{position:'right',border:{display:false},grid:{color:'rgba(255,255,255,0.02)',lineWidth:1},ticks:{maxTicksLimit:6,color:'#4a4a58',font:{family:'Azeret Mono',size:8},callback:v=>'$'+N(v)}}},animation:false}});
}
function gCD(){
    if(tf===1)return c1s.map(c=>({t:c.t,y:c.c}));
    const a=[],b=tf*1000;
    for(const c of c1s){const k=Math.floor(c.t/b)*b,l=a[a.length-1];if(l&&l.t===k)l.y=c.c;else a.push({t:k,y:c.c})}return a;
}
function uCht(){
    const d=gCD(),mx=tf===1?300:tf===3?200:tf===5?150:100,v=d.slice(-mx);
    ch.data.labels=v.map((_,i)=>i);ch.data.datasets[0].data=v.map(d=>d.y);
    const a=ch.options.plugins.annotation.annotations.sl;
    if(cP){a.yMin=cP.sp;a.yMax=cP.sp;a.display=true}else a.display=false;
    ch.update('none');
}
function sTf(t){tf=t;document.querySelectorAll('#ct .tab').forEach(b=>b.classList.toggle('a',parseInt(b.dataset.tf)===t));uCht()}

// AI ORACLE
function rOr(p,t){
    const d=new Date(t),mn=d.getMinutes(),sc=d.getSeconds(),rm=mn%5;
    const iS=(rm===0&&sc<6),iE=(rm===4&&sc>=57);
    uInd();
    if(iS&&!cP){
        const ta=cTA(),wt=Math.floor(t/1000),ws=wt-(wt%300),wid='W-'+ws;
        cP={id:wid,sp:p,dir:ta.sig,conf:ta.conf,st:t,ta};
        svSt();uPUI(cP);uOdS(ta);
        toast(`ðŸ”’ LOCKED: ${ta.sig} @ $${N(p)} (${ta.conf}%)`,'k');pSnd('l');
        document.getElementById('wl').textContent='ACTIVE';document.getElementById('wl').style.background='var(--amber-d)';document.getElementById('wl').style.color='var(--amber)';
        const u=`https://polymarket.com/event/btc-updown-5m-${ws}`;document.getElementById('ptl').href=u;document.getElementById('pml').href=u;
    }
    if(iE&&cP){
        const ac=p>=cP.sp?'UP':'DOWN',res=cP.dir===ac?'WIN':'LOSS';
        if(res==='WIN'){st.w++;st.k=st.t==='W'?st.k+1:1;st.t='W'}else{st.l++;st.k=st.t==='L'?st.k+1:1;st.t='L'}
        localStorage.setItem('b5st2',JSON.stringify(st));uSt();
        sDB({id:cP.id,window_time:new Date(cP.st).toISOString(),start_price:cP.sp,end_price:p,direction:cP.dir,confidence:cP.conf,result:res});
        rMyB(p);
        toast(res==='WIN'?`âœ… WIN! ${cP.dir} â†’ moved ${ac}`:`âŒ LOSS â€” ${cP.dir}, moved ${ac}`,res==='WIN'?'w':'l');
        pSnd(res==='WIN'?'w':'lo');
        cP=null;svSt();document.getElementById('cs').textContent='RESOLVING';
        setTimeout(()=>{rPUI();document.getElementById('wl').textContent='WAITING';document.getElementById('wl').style.background='var(--s3)';document.getElementById('wl').style.color='var(--t3)'},3000);
    }
}

// TA ENGINE
function cTA(){
    const cl=c1s.slice(-120).map(c=>c.c);
    if(cl.length<20)return{sig:Math.random()>0.5?'UP':'DOWN',conf:52,rsi:50,ec:0,macd:0,mom:0,vol:0,n:0};
    const rsi=xRSI(cl,14),e9=xEMA(cl,9),e21=xEMA(cl,21),ec=(e9-e21)/e21*1e4;
    const e12=xEMA(cl,12),e26=xEMA(cl,26),ml=e12-e26;
    const mh=[];for(let i=Math.max(0,cl.length-30);i<cl.length;i++){mh.push(xEMA(cl.slice(0,i+1),12)-xEMA(cl.slice(0,i+1),26))}
    const sl=mh.length>=9?xEMA(mh,9):ml,mcd=ml-sl;
    const mp=Math.min(10,cl.length-1),mom=(cl[cl.length-1]-cl[cl.length-1-mp])/cl[cl.length-1-mp]*1e4;
    const ret=[];for(let i=1;i<cl.length;i++)ret.push((cl[i]-cl[i-1])/cl[i-1]);
    const ar=ret.reduce((a,b)=>a+b,0)/ret.length;
    const vol=Math.sqrt(ret.reduce((a,r)=>a+(r-ar)**2,0)/ret.length)*1e4;
    const s20=cl.slice(-20).reduce((a,b)=>a+b,0)/20;
    const sd=Math.sqrt(cl.slice(-20).reduce((a,v)=>a+(v-s20)**2,0)/20);
    const bb=sd>0?(cl[cl.length-1]-s20)/(2*sd):0;

    let sc=0,wt=0;
    // RSI
    if(rsi<30){sc+=0.8;wt+=1}else if(rsi>70){sc-=0.8;wt+=1}else if(rsi<45){sc+=0.3;wt+=1}else if(rsi>55){sc-=0.3;wt+=1}else wt+=1;
    // EMA
    const ew=1.25;if(ec>2){sc+=0.7*ew}else if(ec<-2){sc-=0.7*ew}else{sc+=ec*0.15*ew}wt+=ew;
    // MACD
    if(mcd>0)sc+=Math.min(0.7,mcd*100);else sc+=Math.max(-0.7,mcd*100);wt+=1;
    // Momentum
    sc+=Math.max(-0.8,Math.min(0.8,mom*0.05));wt+=1;
    // BB
    const bw=0.75;if(bb<-0.8){sc+=0.6*bw}else if(bb>0.8){sc-=0.6*bw}else{sc-=bb*0.3*bw}wt+=bw;

    const n=sc/wt;
    const sig=n>0.02?'UP':(n<-0.02?'DOWN':(Math.random()>0.5?'UP':'DOWN'));
    const conf=Math.min(95,Math.max(50,Math.round(50+Math.abs(n)*50)));
    return{sig,conf,rsi:Math.round(rsi*10)/10,ec:Math.round(ec*10)/10,macd:Math.round(mcd*100)/100,mom:Math.round(mom*10)/10,vol:Math.round(vol*10)/10,n:Math.round(n*100)/100};
}
function xRSI(c,p){if(c.length<p+1)return 50;let g=0,l=0;for(let i=c.length-p;i<c.length;i++){const d=c[i]-c[i-1];d>0?g+=d:l-=d}const ag=g/p,al=l/p;return al===0?100:100-(100/(1+ag/al))}
function xEMA(d,p){if(!d.length)return 0;const k=2/(p+1);let e=d[0];for(let i=1;i<d.length;i++)e=d[i]*k+e*(1-k);return e}

function uInd(){
    if(c1s.length<5)return;const ta=cTA();
    const rc=ta.rsi<30?'var(--bull)':ta.rsi>70?'var(--bear)':'var(--t1)';
    $t('ir',ta.rsi.toFixed(1),rc);
    $t('ie',(ta.ec>0?'+':'')+ta.ec.toFixed(1)+' bps',ta.ec>0?'var(--bull)':'var(--bear)');
    $t('im',(ta.macd>0?'+':'')+ta.macd.toFixed(2),ta.macd>0?'var(--bull)':'var(--bear)');
    $t('imo',(ta.mom>0?'+':'')+ta.mom.toFixed(1)+' bps',ta.mom>0?'var(--bull)':'var(--bear)');
    $t('iv',ta.vol.toFixed(1)+' bps',ta.vol>50?'var(--amber)':'var(--t1)');
}
function uOdS(ta){const u=Math.max(15,Math.min(85,Math.round(50+ta.n*40)));uOd(u,100-u)}

// PREDICTION UI
function uPUI(p){
    const c=document.getElementById('pc'),ic=document.getElementById('pi'),tx=document.getElementById('pt');
    document.getElementById('cs').textContent='LOCKED';document.getElementById('cs').style.background='var(--bull-d)';document.getElementById('cs').style.color='var(--bull)';
    tx.textContent=p.dir;document.getElementById('pf').textContent=`Confidence: ${p.conf}%`;document.getElementById('is').textContent='$'+N(p.sp);
    if(p.dir==='UP'){tx.style.color='var(--bull)';ic.style.background='var(--bull-d)';ic.style.color='var(--bull)';ic.innerHTML='<i class="fa-solid fa-arrow-trend-up"></i>';c.className='card pb'}
    else{tx.style.color='var(--bear)';ic.style.background='var(--bear-d)';ic.style.color='var(--bear)';ic.innerHTML='<i class="fa-solid fa-arrow-trend-down"></i>';c.className='card pr'}
}
function rPUI(){
    document.getElementById('pc').className='card';
    const i=document.getElementById('pi');i.style.cssText='width:48px;height:48px;border-radius:12px;background:var(--s3);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--t3);flex-shrink:0;transition:all 0.4s';i.innerHTML='<i class="fa-solid fa-hourglass-half"></i>';
    document.getElementById('pt').textContent='WAIT';document.getElementById('pt').style.color='var(--t3)';
    document.getElementById('pf').textContent='Confidence: --%';document.getElementById('cs').textContent='WAITING';document.getElementById('cs').style.background='var(--s3)';document.getElementById('cs').style.color='var(--t3)';document.getElementById('is').textContent='â€”';
}

// COUNTDOWN
function sCd(){
    const ci=2*Math.PI*38;
    setInterval(()=>{
        const n=new Date(),ts=n.getMinutes()*60+n.getSeconds(),iw=ts%300,r=299-iw;
        document.getElementById('cd').textContent=`${Math.floor(r/60)}:${(r%60).toString().padStart(2,'0')}`;
        document.getElementById('rf').setAttribute('stroke-dashoffset',ci*(1-iw/300));
        const rf=document.getElementById('rf'),ce=document.getElementById('cd');
        if(r<20){rf.style.stroke='var(--bear)';ce.style.color='var(--bear)'}else{rf.style.stroke='var(--amber)';ce.style.color='var(--amber)'}
        const sm=n.getMinutes()-(n.getMinutes()%5),w1=new Date(n);w1.setMinutes(sm,0,0);const w2=new Date(w1);w2.setMinutes(w1.getMinutes()+5);
        document.getElementById('wr').textContent=w1.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})+' â†’ '+w2.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    },1000);
}

// MANUAL BETS
function pMB(d){
    if(!lp)return toast('âš  Waiting for price...','i');
    const n=new Date(),mn=n.getMinutes(),we=new Date(n);we.setMinutes(mn-(mn%5)+5,0,0);
    mB.unshift({id:'M-'+Date.now(),time:n.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',second:'2-digit'}),dir:d,price:lp,we:we.getTime(),result:'PENDING'});
    if(mB.length>50)mB.pop();localStorage.setItem('b5b4',JSON.stringify(mB));rMB();
    toast(`ðŸ“ ${d} @ $${N(lp)}`,d==='UP'?'w':'l');pSnd('l');
}
function rMyB(ep){
    let c=false;mB.forEach(b=>{if(b.result==='PENDING'&&Date.now()>=b.we-5000){const a=ep>=b.price?'UP':'DOWN';b.result=b.dir===a?'WIN':'LOSS';b.ep=ep;c=true}});
    if(c){localStorage.setItem('b5b4',JSON.stringify(mB));rMB()}
}
function rMB(){
    const el=document.getElementById('ml'),w=mB.filter(b=>b.result==='WIN').length,l=mB.filter(b=>b.result==='LOSS').length;
    document.getElementById('ms').textContent=`${w}W / ${l}L`;
    if(!mB.length){el.innerHTML='<div style="text-align:center;color:var(--t3);font-size:10px;margin-top:24px">Place a call to start tracking.</div>';return}
    el.innerHTML=mB.slice(0,25).map(b=>{
        const dc=b.dir==='UP'?'var(--bull)':'var(--bear)',ic=b.dir==='UP'?'fa-arrow-trend-up':'fa-arrow-trend-down',bg=b.dir==='UP'?'var(--bull-d)':'var(--bear-d)';
        let bd='<span class="badge" style="background:var(--s3);color:var(--t3)">PEND</span>';
        if(b.result==='WIN')bd='<span class="badge" style="background:var(--bull-d);color:var(--bull)">WIN âœ“</span>';
        else if(b.result==='LOSS')bd='<span class="badge" style="background:var(--bear-d);color:var(--bear)">LOSS âœ—</span>';
        return`<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:8px;background:var(--s2);border:1px solid var(--border);margin-bottom:3px"><div style="display:flex;align-items:center;gap:6px"><div style="width:26px;height:26px;border-radius:7px;background:${bg};display:flex;align-items:center;justify-content:center"><i class="fa-solid ${ic}" style="font-size:10px;color:${dc}"></i></div><div><div class="m" style="font-size:10px;color:${dc};font-weight:700">${b.dir} <span style="color:var(--t3);font-weight:400">@ $${N(b.price)}</span></div><div class="m" style="font-size:8px;color:var(--t3)">${b.time}</div></div></div>${bd}</div>`;
    }).join('');
}
function cMB(){if(!mB.length)return;mB=[];localStorage.setItem('b5b4',JSON.stringify(mB));rMB();toast('ðŸ—‘ Cleared','i')}

// STATE
function svSt(){if(cP)localStorage.setItem('b5p',JSON.stringify(cP));else localStorage.removeItem('b5p')}
function rSt(){const s=localStorage.getItem('b5p');if(!s)return;try{const p=JSON.parse(s),we=new Date(p.st);we.setMinutes(we.getMinutes()-(we.getMinutes()%5)+5);if(Date.now()<we.getTime()){cP=p;uPUI(p);document.getElementById('wl').textContent='ACTIVE';document.getElementById('wl').style.background='var(--amber-d)';document.getElementById('wl').style.color='var(--amber)'}else localStorage.removeItem('b5p')}catch(e){}}

// STATS
function uSt(){document.getElementById('sw').textContent=st.w;document.getElementById('sl').textContent=st.l;const t=st.w+st.l;document.getElementById('sp').textContent=t?Math.round(st.w/t*100):'--'}

// SOUND
function tgS(){snd=!snd;localStorage.setItem('b5s',JSON.stringify(snd));uSB()}
function uSB(){const b=document.getElementById('sbt');b.innerHTML=snd?'<i class="fa-solid fa-volume-high"></i>':'<i class="fa-solid fa-volume-xmark"></i>';b.style.color=snd?'var(--amber)':'var(--t3)'}
function pSnd(t){if(!snd)return;try{const a=new(window.AudioContext||window.webkitAudioContext)(),o=a.createOscillator(),g=a.createGain();o.connect(g);g.connect(a.destination);g.gain.value=0.06;
    if(t==='w'){o.frequency.setValueAtTime(523,a.currentTime);o.frequency.setValueAtTime(659,a.currentTime+0.08);o.frequency.setValueAtTime(784,a.currentTime+0.16);g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.4);o.start();o.stop(a.currentTime+0.4)}
    else if(t==='lo'){o.frequency.setValueAtTime(392,a.currentTime);o.frequency.setValueAtTime(311,a.currentTime+0.12);g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.35);o.start();o.stop(a.currentTime+0.35)}
    else{o.frequency.setValueAtTime(587,a.currentTime);g.gain.exponentialRampToValueAtTime(0.001,a.currentTime+0.12);o.start();o.stop(a.currentTime+0.12)}}catch(e){}}

// TOAST
function toast(m,t='i'){const z=document.getElementById('tz'),e=document.createElement('div');e.className='toast t'+t;e.textContent=m;z.appendChild(e);setTimeout(()=>{if(e.parentNode)e.remove()},4000)}

// HELPERS
function N(v){return Number(v).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}
function $s(id,t,bg,c){const e=document.getElementById(id);if(e){e.textContent=t;e.style.background=bg;e.style.color=c}}
function $t(id,t,c){const e=document.getElementById(id);if(e){e.textContent=t;if(c)e.style.color=c}}
</script>
</body>
</html>